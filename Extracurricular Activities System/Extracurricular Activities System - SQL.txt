/* KFUPM Extracurricular Activities System */
CREATE TABLE STUDENT(
    STUDENT_ID      INT         NOT NULL    PRIMARY KEY,
    STUDENT_FNAME   VARCHAR(20) NOT NULL,
    STUDENT_LNAME   VARCHAR(20) NOT NULL,
    STUDENT_MOBILE  CHAR(10)    NOT NULL,
    STUDENT_LEVEL   VARCHAR(10) NOT NULL
);

CREATE TABLE CLUB(
    CLUB_ID                 INT                 NOT NULL PRIMARY KEY,
    CLUB_NAME               VARCHAR(30) UNIQUE  NOT NULL, 
    CLUB_JOIN_REQUIREMENT   VARCHAR(30)         NOT NULL,
    CLUB_SIZE               SMALLINT            NOT NULL,    
    CLUB_LEADER_ID          INT                 NOT NULL,
    FOREIGN KEY (CLUB_LEADER_ID) REFERENCES STUDENT (STUDENT_ID) ON DELETE CASCADE
);

CREATE TABLE EVENT(
    EVENT_ID            INT         NOT NULL PRIMARY KEY,
    EVENT_NAME          VARCHAR(50) NOT NULL,
    EVENT_LOCATION      VARCHAR(30) NOT NULL,
    EVENT_DATE          DATE        NOT NULL,
    EVENT_START_TIME    VARCHAR(8)  NOT NULL,
    EVENT_END_TIME      VARCHAR(8)  NOT NULL,
    EVENT_TYPE          VARCHAR(10) NOT NULL,
    CLUB_ID             INT             NULL,
    FOREIGN KEY (CLUB_ID) REFERENCES CLUB (CLUB_ID)
);

CREATE TABLE ATTENDANCE_RECORD(
    STUDENT_ID          INT         NOT NULL,
    EVENT_ID            INT         NOT NULL,
    ATTENDANCE_STATUS   VARCHAR(10) NOT NULL CHECK(ATTENDANCE_STATUS = 'Attended' OR ATTENDANCE_STATUS = 'Absent'),
    PRIMARY KEY (STUDENT_ID, EVENT_ID),
    FOREIGN KEY (STUDENT_ID)    REFERENCES STUDENT (STUDENT_ID) ON DELETE CASCADE,
    FOREIGN KEY (EVENT_ID)      REFERENCES EVENT (EVENT_ID)     ON DELETE CASCADE
);

CREATE TABLE MEMBERSHIP(
    STUDENT_ID          INT     NOT NULL,
    CLUB_ID             INT     NOT NULL,
    MEMBER_JOIN_DATE    DATE    DEFAULT (SYSDATE) NOT NULL ,
    FOREIGN KEY (STUDENT_ID)    REFERENCES STUDENT (STUDENT_ID) ON DELETE CASCADE,
    FOREIGN KEY (CLUB_ID)       REFERENCES CLUB (CLUB_ID)       ON DELETE CASCADE,
    PRIMARY KEY (STUDENT_ID, CLUB_ID)
);

/*Dummy*/
/* STUDENT rows    */
INSERT INTO STUDENT VALUES(201959330, 'Meshal',   'Alduhaymish', '0553629869', 'Sophomore');
INSERT INTO STUDENT VALUES(201938290, 'Adeeb',    'Katib',       '0553629811', 'Sophomore');
INSERT INTO STUDENT VALUES(201911113, 'Raed',     'Alshehri',    '0553629812', 'Junior'   );
INSERT INTO STUDENT VALUES(201911114, 'Salman',   'Felemban',    '0553629813', 'Sophomore');
INSERT INTO STUDENT VALUES(201911115, 'Anas',     'Aldossary',   '0553629814', 'Sophomore');
INSERT INTO STUDENT VALUES(201211116, 'Khaled',   'Saleh',       '0553629815', 'Senior'   );
INSERT INTO STUDENT VALUES(201211117, 'Nasser',   'Rashed',      '0553629816', 'Senior'   );
INSERT INTO STUDENT VALUES(202011111, 'Mohammed', 'Mansor',      '0553629817', 'Freshmen' );
INSERT INTO STUDENT VALUES(202111111, 'Mousa',    'Adel',        '0553629818', 'Freshmen' );
INSERT INTO STUDENT VALUES(201511111, 'Meshal',   'Alghamdi',    '0553629819', 'Senior'   );


/* CLUB rows    */
INSERT INTO CLUB VALUES(1001,'Business School Club', 'Business Student', 300, 201959330);
INSERT INTO CLUB VALUES(1002,'Computer Club', 'None', 400, 201938290);
INSERT INTO CLUB VALUES(1003,'Chemical Engineering Club', 'Chemical Engineering Student', 250, 201911113);
INSERT INTO CLUB VALUES(1004,'Sports Club', 'None', 400, 201911114);
INSERT INTO CLUB VALUES(1005,'Gaming Club', 'None', 600, 201911115);
INSERT INTO CLUB VALUES(1006,'Toastmasters Club', 'None', 150, 201211116);
INSERT INTO CLUB VALUES(1007,'Art Club', 'None', 200, 201211117);
INSERT INTO CLUB VALUES(1008,'Mechanical Engineering Club', 'Mechanical Engineering Student', 250, 202011111);
INSERT INTO CLUB VALUES(1009,'Sustainability Club', 'None', 100, 202111111);
INSERT INTO CLUB VALUES(1010,'Consulting Club', 'None', 400, 201511111);


/* EVENT rows */
INSERT INTO EVENT VALUES(10010, 'Gathering Night', 'KFUPM Mall', DATE '2022-04-14', '22:00', '1:00', 'CLUB',1005);
INSERT INTO EVENT VALUES(10011, 'Speaking competition', 'KFUPM Dorms', DATE '2022-05-14', '17:00', '19:00', 'CLUB', 1006);
INSERT INTO EVENT VALUES(10012, 'Poetry competition', 'KFUPM Dorms', DATE '2022-05-15', '16:00', '18:00', 'CLUB', 1006);
INSERT INTO EVENT VALUES(10013, 'Games competition', 'KFUPM Dorms', DATE '2022-05-16', '17:00', '20:00', 'CLUB', 1005);
INSERT INTO EVENT VALUES(10014, 'KFUPM Olympics', 'Building 39', DATE '2022-04-18', '21:30', '1:00', 'CLUB', 1004);
INSERT INTO EVENT VALUES(10015, 'Automation at Aramco', 'Student Activities hall', DATE '2022-02-13', '23:15', '1:00', 'CLUB', 1008);
INSERT INTO EVENT VALUES(10016, 'VALORANT tournament', 'Online', DATE '2022-02-10', '20:30', '23:30', 'CLUB', 1005);
INSERT INTO EVENT VALUES(10017, 'How to get linked to investors', 'Online', DATE '2022-04-12', '17:30', '19:00', 'CLUB', 1010);
INSERT INTO EVENT VALUES(10018, 'Cyber Security in a Digital World ', 'Building 24', DATE '2022-03-31', '14:00', '16:00', 'SSC', NULL);
INSERT INTO EVENT VALUES(10019, 'How to write a great CV', 'Online', DATE '2022-03-29', '20:00', '21:30', 'SSC', NULL);



/* ATTENDANCE_RECORD rows    */
INSERT INTO ATTENDANCE_RECORD VALUES(201959330, 10013, 'Attended');
INSERT INTO ATTENDANCE_RECORD VALUES(201938290, 10013, 'Attended');
INSERT INTO ATTENDANCE_RECORD VALUES(201211117, 10018, 'Absent');
INSERT INTO ATTENDANCE_RECORD VALUES(201911113, 10014, 'Attended');
INSERT INTO ATTENDANCE_RECORD VALUES(201959330, 10012, 'Absent');
INSERT INTO ATTENDANCE_RECORD VALUES(201911114, 10019, 'Attended');
INSERT INTO ATTENDANCE_RECORD VALUES(201911115, 10011, 'Absent');
INSERT INTO ATTENDANCE_RECORD VALUES(202011111, 10017, 'Attended');
INSERT INTO ATTENDANCE_RECORD VALUES(202111111, 10014, 'Attended');
INSERT INTO ATTENDANCE_RECORD VALUES(201511111, 10016, 'Absent');

/* MEMBERSHIP rows    */
INSERT INTO MEMBERSHIP VALUES(201959330, 1001, DATE '2020-01-01');
INSERT INTO MEMBERSHIP VALUES(201211116, 1003, DATE '2017-09-01');
INSERT INTO MEMBERSHIP VALUES(201938290, 1001, DATE '2021-02-01');
INSERT INTO MEMBERSHIP VALUES(201959330, 1005, DATE '2020-04-07');
INSERT INTO MEMBERSHIP VALUES(202111111, 1002, DATE '2021-12-11');
INSERT INTO MEMBERSHIP VALUES(201511111, 1004, DATE '2016-10-02');
INSERT INTO MEMBERSHIP VALUES(201911115, 1007, DATE '2020-03-10');
INSERT INTO MEMBERSHIP VALUES(201911114, 1006, DATE '2021-01-11');
INSERT INTO MEMBERSHIP VALUES(201911113, 1010, DATE '2022-01-24');
INSERT INTO MEMBERSHIP VALUES(201211117, 1009, DATE '2015-07-27');


/* Queries */
/* THE NAME AND CONTACT NUMBER OF EACH CLUB LEADER */
SELECT CLUB_NAME, CONCAT(STUDENT_FNAME,  STUDENT_LNAME) AS LEADER_NAME, STUDENT_MOBILE
FROM CLUB INNER JOIN STUDENT ON CLUB.CLUB_LEADER_ID = STUDENT.STUDENT_ID
ORDER BY CLUB_NAME;

/* EVERY REGISTERED EVENT FOR A STUDENT*/
SELECT STUDENT_ID, STUDENT_FNAME, STUDENT_LNAME, EVENT_NAME, ATTENDANCE_STATUS
FROM STUDENT NATURAL JOIN ATTENDANCE_RECORD NATURAL JOIN EVENT
WHERE STUDENT_ID = 201959330;

/* ATTENDANCE SUMMARY FOR AN EVENT */
SELECT EVENT_ID, STUDENT_ID, STUDENT_FNAME, STUDENT_LNAME, ATTENDANCE_STATUS
FROM EVENT NATURAL JOIN ATTENDANCE_RECORD NATURAL JOIN STUDENT
WHERE EVENT_ID = 10013;

/* EVERY CLUB A STUDENT IS REGISTERED IN */
SELECT STUDENT_ID, CLUB_ID, CLUB_NAME, MEMBER_JOIN_DATE
FROM STUDENT NATURAL JOIN MEMBERSHIP NATURAL JOIN CLUB
WHERE STUDENT_ID = 201938290;

/* LIST OF ALL EVENTS ORGANIZED BY A CLUB */
SELECT EVENT_ID, EVENT_NAME, EVENT_DATE, CLUB_NAME
FROM EVENT NATURAL JOIN CLUB
WHERE CLUB_ID = 1005;

/* LIST OF EVENTS ORGANIZED BY SSC */
SELECT EVENT_ID, EVENT_NAME, EVENT_DATE
FROM EVENT
WHERE EVENT_TYPE = 'SSC';